[include mainsail.cfg]
[include modules/*.cfg]
[include KAMP_Settings.cfg]
#[include AFC/*.cfg]

# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v3.0. To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication/USART.

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.
#....

# See docs/Config_Reference.md for a description of parameters.

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_20001C001650344D30363620-if00

[mcu host]
serial: /tmp/klipper_host_mcu

[mcu eddy]
serial: /dev/serial/by-id/usb-Klipper_rp2040_504434031047231C-if00
restart_method: command

[exclude_object]

[auto_speed]

[force_move]
enable_force_move: false

[gcode_arcs]
resolution: 0.1

[printer]
kinematics: corexy
max_velocity: 400
max_accel: 15000
max_z_velocity: 10
max_z_accel: 100

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16 #32
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: -1
position_max: 235
position_min: -1
homing_speed: 50
homing_retract_dist: 5

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 1.2
interpolate: true

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16 #32
rotation_distance: 40
endstop_pin: ^!PC1
position_endstop: 249
position_max: 249
position_min: 0
homing_speed: 50
homing_retract_dist: 5

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
run_current: 1.2
interpolate: true

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16 #32
rotation_distance: 1
endstop_pin: probe:z_virtual_endstop
position_max: 248
position_min: -1
homing_retract_dist: 5

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.8
interpolate: true

[extruder]
step_pin: PB3
dir_pin: PB4
enable_pin: !PD1
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 5.55
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
min_temp: 0
max_temp: 280
max_extrude_cross_section: 5
max_extrude_only_distance: 400

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650

[filament_switch_sensor RunoutSensor]
pause_on_runout: true
runout_gcode: PAUSE
insert_gcode: RESUME
switch_pin: ^PC15

[heater_bed]
heater_pin: PC9
sensor_type: Generic 3950
sensor_pin: PC4
max_power: 0.8
min_temp: 0
max_temp: 120

[fan] #part cooling fan
pin: PC7
off_below: 0.099
kick_start_time: 0.5

[heater_fan hotend_fan] #hotend cooling fan
pin: PC6
heater: extruder 

[temperature_fan Controller]    #[temperature_sensor BTT_controller]
pin: PB15
kick_start_time: 0.8
off_below: 0.2
max_power: 1.0
sensor_type: temperature_mcu
control: pid
min_temp: 0
max_temp: 85
pid_kp: 1.0
pid_ki: 0.5
pid_kd: 2.0
min_speed: 0.1
max_speed: 0.8
target_temp: 35

[temperature_fan BTT_pi]
pin: host:gpio211
kick_start_time: 0.8
off_below: 0.1
max_power: 1.0
sensor_type: temperature_host
control: pid
min_temp: 0
max_temp: 85
pid_kp: 1.0
pid_ki: 0.5
pid_kd: 2.0
min_speed: 0.1
max_speed: 1
target_temp: 38

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

[skew_correction]
#SET_SKEW XY=141.02,140.7,99.57

[bed_mesh]
horizontal_move_z: 2
speed: 400
# For the mesh dimensions below, the coordinates need to be reachable by the center of the probe. To calculate coordinates that will work, use the formula below:
# mesh x min = position_min_x + greater_of (15mm or x_offset) <--- in this term, only consider the x offset if it is positive, ignore if negative.
# mesh y min = position_min_y + greater_of (15mm or y_offset) <--- in this term, only consider the y offset if it is positive, ignore if negative.
# mesh x max = position_max_x - greater_of (15mm or |x_offset|) <--- in this term, only consider the x offset if it is negative, ignore if positive.
# mesh y max = position_max_y - greater_of (15mm or |y_offset|) <--- in this term, only consider the y offset if it is negative, ignore if positive.
# Example: Consider that you have a 300 x 300 bed with the max x and y positions being 300 and the min being 0. Your probe offsets are -20 for X and 10 for Y
# For mesh x min we ignore the x offset term because it is negative. Therefore mesh x min = 15
# For mesh y min we do not ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y min = 15
# For mesh x max we do not ignore the x offset term because it is negative. It is also greater than 15. Therefore mesh x max = 280
# For mesh y max we ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y max = 285
# The final result would be mesh_min: 15, 15 mesh_max: 280, 285
mesh_min: 16, 35  # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
mesh_max: 220, 220 # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
probe_count: 9, 9 #15, 15
algorithm: bicubic
#scan_overshoot: 8  #uncomment this section if you still have room left over on the X axis for some scan overshoot to product smoother movements and more accurate scanning. Uncommenting this should be fine if you are using a standard voron mount.

# Uncomment this if you are using Eddy as the probe AND the homing endstop
[safe_z_home]
home_xy_position: 117.5, 117.5 # Choose an X,Y position that is in the center of your bed. For a 300x300 machine that will be 150, 150. Use the same principle to calculate your bed center.
z_hop: 5
z_hop_speed: 25
speed: 400

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 57.815
#*# pid_ki = 1.140
#*# pid_kd = 732.809
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 39.869
#*# pid_ki = 17.720
#*# pid_kd = 22.427
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 61.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 45.6
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.232215, 0.221491, 0.219914, 0.196781, 0.208862, 0.205692, 0.208862, 0.212025, 0.212025
#*# 	  0.126778, 0.131438, 0.121887, 0.116894, 0.120194, 0.116894, 0.126778, 0.126778, 0.150075
#*# 	  0.076138, 0.060943, 0.051074, 0.052452, 0.060943, 0.065685, 0.069396, 0.084269, 0.086971
#*# 	  0.010434, 0.013897, 0.012168, 0.003485, 0.016695, 0.008697, 0.035377, 0.058595, 0.076845
#*# 	  0.017360, -0.005237, -0.008734, -0.016832, -0.013657, -0.001746, 0.029167, 0.049051, 0.067384
#*# 	  0.003485, -0.005237, -0.007333, -0.025370, -0.015076, 0.003485, 0.036037, 0.062637, 0.090964
#*# 	  0.042220, 0.015631, 0.003807, 0.010434, 0.014954, 0.034321, 0.072770, 0.098658, 0.130063
#*# 	  0.070820, 0.062637, 0.055850, 0.052452, 0.062637, 0.091974, 0.116894, 0.144518, 0.192972
#*# 	  0.108626, 0.076845, 0.061264, 0.077553, 0.101660, 0.122533, 0.163365, 0.196160, 0.239422
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 16.0
#*# max_x = 220.0
#*# min_y = 35.0
#*# max_y = 219.96000000000004
#*#
#*# [probe_eddy_ng btt_eddy]
#*# calibrated_drive_currents = 15, 16
#*# calibration_version = 5
#*# reg_drive_current = 16
#*# tap_drive_current = 16
#*# calibration_15 = gASVywMAAAAAAAB9lCiMAXaUSwWMBGZ0b2iUjBtudW1weS5wb2x5bm9taWFsLnBvbHlub21pYWyUjApQb2x5bm9taWFslJOUKYGUfZQojARjb2VmlIwWbnVtcHkuX2NvcmUubXVsdGlhcnJheZSMDF9yZWNvbnN0cnVjdJSTlIwFbnVtcHmUjAduZGFycmF5lJOUSwCFlEMBYpSHlFKUKEsBSwqFlGgMjAVkdHlwZZSTlIwCZjiUiYiHlFKUKEsDjAE8lE5OTkr/////Sv////9LAHSUYolDUBQ4R2pKXPc/mVuTSNtL/z/M+u4cmJ/sPyK/ZZQyDsE/oSWsMPJt1L+eOPS94+DuP/jyzQjBjOk/spLugR3d87+QtAbZaT3Vv3uyDRPC5OU/lHSUYowGZG9tYWlulGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQbBZoCOwdlT63NenizkqVPpR0lGKMBndpbmRvd5RoC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEAAAAAAAAPC/AAAAAAAA8D+UdJRijAdfc3ltYm9slIwBeJSMBnN5bWJvbJRoLHVijAlmdG9oX2hpZ2iUaAUpgZR9lChoCGgLaA5LAIWUaBCHlFKUKEsBSwqFlGgYiUNQZ9HmL5xrG0AW7pEaY5sLQO16/wrXoAFAw7BH0PHMA0B9qxJi4Wj/vxfUF3ek7RzAVxckIu8JF0DpQ9CgOq0rQJzAOf716wfAT+y48kDtHMCUdJRiaB1oC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEAos2qApSZU+VXQvYl1VlT6UdJRiaCRoC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEAAAAAAAAPC/AAAAAAAA8D+UdJRiaCtoLGgtaCx1YowEaHRvZpRoBSmBlH2UKGgIaAtoDksAhZRoEIeUUpQoSwFLCoWUaBiJQ1DnCVkjHD6VPljFKtkNPxM+2quYGZ8lAr7W+rZIuG7rPbWW8YkdIMw9jEuS0O3v0r3PcS4+AGj7vTCftYGAefY9V9jxev7O9D0yLrvNkHnyvZR0lGJoHWgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQACB+l5wKHT8AJTYLPPETQJR0lGJoJGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGJoK2gsaC1oLHVijAdoX3JhbmdllF2UKEc/HQqcl34gAEdALgAAAAAAAGWMB2ZfcmFuZ2WUXZQoR0FH//bxjggAR0FIPvoKBoAAZYwCZGOUSw91Lg==
#*# calibration_16 = gASVywMAAAAAAAB9lCiMAXaUSwWMBGZ0b2iUjBtudW1weS5wb2x5bm9taWFsLnBvbHlub21pYWyUjApQb2x5bm9taWFslJOUKYGUfZQojARjb2VmlIwWbnVtcHkuX2NvcmUubXVsdGlhcnJheZSMDF9yZWNvbnN0cnVjdJSTlIwFbnVtcHmUjAduZGFycmF5lJOUSwCFlEMBYpSHlFKUKEsBSwqFlGgMjAVkdHlwZZSTlIwCZjiUiYiHlFKUKEsDjAE8lE5OTkr/////Sv////9LAHSUYolDUIu5bKyWxPU/oKRXo5To/T98nIJW1w7oP0B+tZ2UCdw/Cvi27oHZ0j+9TI/4v2nXvyCGAxSV7p8/FBpKJxzg7D+xXWfCE+CrP8Gg5DfCGta/lHSUYowGZG9tYWlulGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQcUAXXXEXlT77wQzUHmaVPpR0lGKMBndpbmRvd5RoC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEAAAAAAAAPC/AAAAAAAA8D+UdJRijAdfc3ltYm9slIwBeJSMBnN5bWJvbJRoLHVijAlmdG9oX2hpZ2iUaAUpgZR9lChoCGgLaA5LAIWUaBCHlFKUKEsBSwqFlGgYiUNQ9qIyAvzCGkAymozZRugJQMXqq0uy+Po/s1fBFgIF9D8CboieDPfnPzcnV1HhtOi/pIYDsQQZu78dmkv0EYUBQGW/xHGcFuk/9yQMrgPY47+UdJRiaB1oC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEL6t2QKLY5U+cgSnbOJ0lT6UdJRiaCRoC2gOSwCFlGgQh5RSlChLAUsChZRoGIlDEAAAAAAAAPC/AAAAAAAA8D+UdJRiaCtoLGgtaCx1YowEaHRvZpRoBSmBlH2UKGgIaAtoDksAhZRoEIeUUpQoSwFLCoWUaBiJQ1CfjkD/wlGVPohHGHUvNiA+IYc6w4/VEb4J2zXMdGMCPqEEtgqVCvY9oA8PefBkEr4Wlci7OQARvn1qFTE4XSI+pxwvm8vHBD6o5wzVIdAUvpR0lGJoHWgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQgCzTTtYNQD8A7KyAx/gTQJR0lGJoJGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGJoK2gsaC1oLHVijAdoX3JhbmdllF2UKEc/QA3WTtMsgEdALf/0Z27cF2WMB2ZfcmFuZ2WUXZQoR0FH3LV3ebAAR0FIRmzG33AAZYwCZGOUSxB1Lg==
